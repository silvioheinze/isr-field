{% extends 'datasets/_base.html' %}
{% load dataset_extras %}

{% block title %}Create Entry - ISR Field{% endblock %}

{% block content %}
<div class="container mt-4" style="max-width: 800px;">
    <h2>Create New Entry</h2>
    <p class="text-muted">Geometry: {{ geometry.id_kurz }} - {{ geometry.address }}</p>
    <p class="text-muted">Created by: {{ request.user.username }}</p>
    
    <form method="post">
        {% csrf_token %}
        <div class="row">
            <div class="col-md-6">
                <div class="mb-3">
                    <label for="name" class="form-label">Name</label>
                    <input type="text" class="form-control" id="name" name="name" required>
                </div>
            </div>
            <div class="col-md-6">
                <div class="mb-3">
                    <label for="year" class="form-label">Year</label>
                    <input type="number" class="form-control" id="year" name="year" value="2024" required>
                </div>
            </div>
        </div>
        
        <!-- Dynamic Fields -->
        {% for field in all_fields %}
            {% if field.enabled %}
                <div class="mb-3">
                    <label for="{{ field.field_name }}" class="form-label">{{ field.label }}
                        {% if field.required %}<span class="text-danger">*</span>{% endif %}
                    </label>
                    {% if field.field_type == 'text' %}
                        <input type="text" class="form-control" id="{{ field.field_name }}" name="{{ field.field_name }}" 
                               {% if field.required %}required{% endif %}>
                    {% elif field.field_type == 'integer' %}
                        <input type="number" class="form-control" id="{{ field.field_name }}" name="{{ field.field_name }}" 
                               {% if field.required %}required{% endif %}>
                    {% elif field.field_type == 'decimal' %}
                        <input type="number" step="0.01" class="form-control" id="{{ field.field_name }}" name="{{ field.field_name }}" 
                               {% if field.required %}required{% endif %}>
                    {% elif field.field_type == 'boolean' %}
                        <select class="form-control" id="{{ field.field_name }}" name="{{ field.field_name }}" 
                                {% if field.required %}required{% endif %}>
                            <option value="">Select option</option>
                            <option value="true">Yes</option>
                            <option value="false">No</option>
                        </select>
                    {% elif field.field_type == 'date' %}
                        <input type="date" class="form-control" id="{{ field.field_name }}" name="{{ field.field_name }}" 
                               {% if field.required %}required{% endif %}>
                    {% elif field.field_type == 'choice' %}
                        <select class="form-control" id="{{ field.field_name }}" name="{{ field.field_name }}" 
                                {% if field.required %}required{% endif %}>
                            <option value="">Select option</option>
                            {% for choice in field|get_choices_list %}
                                {% if choice.value %}
                                    <option value="{{ choice.value }}">{{ choice.label }}</option>
                                {% else %}
                                    <option value="{{ choice }}">{{ choice }}</option>
                                {% endif %}
                            {% endfor %}
                        </select>
                    {% else %}
                        <input type="text" class="form-control" id="{{ field.field_name }}" name="{{ field.field_name }}" 
                               {% if field.required %}required{% endif %}>
                    {% endif %}
                    {% if field.help_text %}
                        <div class="form-text">{{ field.help_text }}</div>
                    {% endif %}
                </div>
            {% endif %}
        {% endfor %}
        
                        <button type="submit" class="btn btn-primary">
                    <i class="bi bi-plus-circle"></i> Create Entry
                </button>
        <a href="{% url 'dataset_data_input' geometry.dataset.id %}" class="btn btn-secondary">Cancel</a>
    </form>
</div>
{% endblock %} 